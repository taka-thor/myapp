<div class="min-h-screen flex flex-col">
  <!-- タイトル -->
  <header class="px-6 pt-6 pb-4">
    <h1 class="text-lg font-semibold text-center">アイコンを選んでください</h1>
  </header>

  <!-- アイコン一覧 -->
  <main class="flex-1 overflow-y-auto px-6 pb-28">
    <div class="grid grid-cols-4 gap-4 justify-items-center">

      <% @icons.each do |icon| %>
        <button
          type="button"
          class="icon-option relative rounded-full p-[3px] transition ring-0 focus:outline-none"
          data-icon-id="<%= icon %>"
        >
          <div
            class="w-16 h-16 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center"
          >
            <img
              src="<%= icon %>"
              alt="アイコン"
              class="w-full h-full object-cover"
            />
          </div>
        </button>
      <% end %>
    </div>
  </main>

  <!-- 決定ボタン（最初は非表示） -->
  <%= form_with model: @user, url: user_icons_path, method: :post, id: "icon-form",
        class: "fixed bottom-0 left-0 right-0 px-6 pb-6 pointer-events-none" do %>
    <input type="hidden" name="user[icon_id]" id="selected-icon-id" />

    <button
      type="submit"
      id="icon-submit"
      class="w-full py-3 rounded-xl bg-purple-500 text-white font-semibold shadow-lg opacity-0 translate-y-4 transition pointer-events-none"
    >
      決定
    </button>
  <% end %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const options = document.querySelectorAll(".icon-option");
    const hiddenInput = document.getElementById("selected-icon-id");
    const submitBtn = document.getElementById("icon-submit");
    const form = document.getElementById("icon-form");

    options.forEach((option) => {
      option.addEventListener("click", () => {
        // 他の選択状態をリセット
        options.forEach((o) => o.classList.remove("ring-4", "ring-purple-400"));

        // クリックしたものだけ外枠をつける
        option.classList.add("ring-4", "ring-purple-400");

        // hidden に選択中の icon_id をセット
        hiddenInput.value = option.dataset.iconId;

        // 決定ボタンを表示 & 有効化
        submitBtn.classList.remove(
          "opacity-0",
          "translate-y-4",
          "pointer-events-none"
        );
        form.classList.remove("pointer-events-none");
      });
    });
  });
</script>
